@using System.Text.Json
@{
    ViewData["Title"] = "Admin Dashboard - CineMax";
}

<!-- Admin Dashboard -->
<div class="container-fluid py-4 dashboard-container">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="fw-bold">
                <i class="bi bi-speedometer2 me-2 text-cinema-red"></i>
                Dashboard Qu·∫£n Tr·ªã
            </h2>
            <p class="text-muted">Ch√†o m·ª´ng quay tr·ªü l·∫°i, @User.Identity?.Name</p>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-4 mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="stat-card glass-card p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1">T·ªïng Phim</p>
                        <h3 class="fw-bold mb-0">@ViewBag.TotalMovies</h3>
                    </div>
                    <div class="stat-icon bg-cinema-red">
                        <i class="bi bi-film"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="stat-card glass-card p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1">R·∫°p Chi·∫øu</p>
                        <h3 class="fw-bold mb-0">@ViewBag.TotalCinemas</h3>
                    </div>
                    <div class="stat-icon bg-popcorn-gold">
                        <i class="bi bi-building"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="stat-card glass-card p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1">Ph√≤ng Chi·∫øu</p>
                        <h3 class="fw-bold mb-0">@ViewBag.TotalRooms</h3>
                    </div>
                    <div class="stat-icon bg-success">
                        <i class="bi bi-ticket-perforated"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="stat-card glass-card p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1">Doanh Thu</p>
                        <h3 class="fw-bold mb-0">@(((decimal)ViewBag.TotalRevenue).ToString("N0")) VNƒê</h3>
                    </div>
                    <div class="stat-icon bg-info">
                        <i class="bi bi-currency-dollar"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4 mb-4">
        <!-- Revenue Chart -->
        <div class="col-lg-8">
            <div class="glass-card p-4 chart-card">
                <h5 class="fw-bold mb-4">
                    <i class="bi bi-graph-up me-2 text-cinema-red"></i>
                    Doanh Thu 7 Ng√†y Qua
                </h5>
                <div id="revenueChart" style="width: 100%; height: 350px;"></div>
            </div>
        </div>

        <!-- Booking Status Pie Chart -->
        <div class="col-lg-4">
            <div class="glass-card p-4 chart-card">
                <h5 class="fw-bold mb-4">
                    <i class="bi bi-pie-chart me-2 text-popcorn-gold"></i>
                    Tr·∫°ng Th√°i ƒê·∫∑t V√©
                </h5>
                <div id="statusChart" style="width: 100%; height: 320px;"></div>
            </div>
        </div>
    </div>

    <!-- Top Movies Chart -->
    <div class="row g-4 mb-4">
        <div class="col-12">
            <div class="glass-card p-4 chart-card">
                <h5 class="fw-bold mb-4">
                    <i class="bi bi-calendar-event me-2 text-cinema-red"></i>
                    L·ªãch Chi·∫øu Top 5 Phim Hot
                </h5>
                <div id="ganttChart" style="width: 100%; height: 350px;"></div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4">
        <div class="col-md-12">
            <div class="glass-card p-4">
                <h5 class="fw-bold mb-4">
                    <i class="bi bi-lightning-charge me-2 text-cinema-red"></i>
                    Thao T√°c Nhanh
                </h5>
                <div class="row g-3">
                    <div class="col-md-3">
                        <a href="/Admin/Movies/Create" class="btn btn-cinema-red w-100">
                            <i class="bi bi-plus-circle me-2"></i>
                            Th√™m Phim M·ªõi
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/Admin/Showtimes/Create" class="btn btn-outline-light w-100">
                            <i class="bi bi-plus-circle me-2"></i>
                            T·∫°o L·ªãch Chi·∫øu
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/Admin/Genres" class="btn btn-outline-light w-100">
                            <i class="bi bi-tags me-2"></i>
                            Qu·∫£n L√Ω Th·ªÉ Lo·∫°i
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/Admin/Foods" class="btn btn-outline-light w-100">
                            <i class="bi bi-cup-straw me-2"></i>
                            Qu·∫£n L√Ω ƒê·ªì ƒÇn
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<style>
    /* Dashboard Premium Styles */
    .dashboard-container {
        color: #fff;
    }

    .dashboard-container .text-muted {
        color: #cbd5e1 !important;
    }
    
    .dashboard-container h2, 
    .dashboard-container h3, 
    .dashboard-container h5 {
        color: #fff !important;
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    /* Enhanced Premium Cards */
    .dashboard-container .stat-card,
    .dashboard-container .glass-card {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%) !important;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 
                    0 0 0 1px rgba(255, 255, 255, 0.05) inset;
        border-radius: 16px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .dashboard-container .stat-card::before,
    .dashboard-container .glass-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.5s;
    }

    .dashboard-container .stat-card:hover::before,
    .dashboard-container .glass-card:hover::before {
        left: 100%;
    }

    .dashboard-container .stat-card:hover,
    .dashboard-container .glass-card:hover {
        transform: translateY(-8px);
        border-color: rgba(255, 255, 255, 0.3);
        box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5),
                    0 0 0 1px rgba(255, 255, 255, 0.1) inset,
                    0 0 20px rgba(220, 38, 38, 0.3);
    }

    .chart-card {
        min-height: 400px;
    }

    .stat-icon {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
    }

    .stat-card:hover .stat-icon {
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 12px 24px rgba(0,0,0,0.4);
    }

    .bg-cinema-red {
        background: linear-gradient(135deg, #ef4444, #dc2626, #991b1b);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    }

    .bg-popcorn-gold {
        background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
        box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
    }

    .bg-success {
        background: linear-gradient(135deg, #10b981, #059669, #047857);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .bg-info {
        background: linear-gradient(135deg, #3b82f6, #2563eb, #1d4ed8);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
</style>


<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-3d.js"></script>
<script src="https://code.highcharts.com/modules/gantt.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script>
    // Premium Chart Library for CineMax Dashboard
    class CinemaChart {
        constructor(canvasId) {
            this.canvas = document.getElementById(canvasId);
            if (!this.canvas) {
                console.error(`Canvas ${canvasId} not found`);
                return;
            }
            this.ctx = this.canvas.getContext('2d');
            this.setupCanvas();
        }

        setupCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = this.canvas.getBoundingClientRect();
            this.canvas.width = rect.width * dpr;
            this.canvas.height = rect.height * dpr;
            this.ctx.scale(dpr, dpr);
            this.width = rect.width;
            this.height = rect.height;
        }

        clear() {
            this.ctx.clearRect(0, 0, this.width, this.height);
        }

        // Draw premium column chart with gradients
        drawColumnChart(data, options = {}) {
            this.clear();
            const padding = { top: 50, right: 50, bottom: 70, left: 90 };
            const chartWidth = this.width - padding.left - padding.right;
            const chartHeight = this.height - padding.top - padding.bottom;

            const maxValue = Math.max(...data.map(d => d.value));
            const barWidth = Math.min(chartWidth / data.length * 0.65, 80);
            const barSpacing = chartWidth / data.length;

            // Draw grid lines
            this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.08)';
            this.ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartHeight / 5) * i;
                this.ctx.beginPath();
                this.ctx.moveTo(padding.left, y);
                this.ctx.lineTo(padding.left + chartWidth, y);
                this.ctx.stroke();

                // Y-axis labels
                const value = maxValue * (1 - i / 5);
                this.ctx.fillStyle = '#94a3b8';
                this.ctx.font = 'bold 13px Inter, -apple-system, sans-serif';
                this.ctx.textAlign = 'right';
                this.ctx.fillText(this.formatNumber(value), padding.left - 15, y + 5);
            }

            // Draw bars with premium gradients
            data.forEach((item, index) => {
                const x = padding.left + index * barSpacing + (barSpacing - barWidth) / 2;
                const barHeight = (item.value / maxValue) * chartHeight;
                const y = padding.top + chartHeight - barHeight;

                // Gradient
                const gradient = this.ctx.createLinearGradient(x, y, x, y + barHeight);
                gradient.addColorStop(0, '#f87171');
                gradient.addColorStop(0.5, '#ef4444');
                gradient.addColorStop(1, '#b91c1c');

                // Glow effect
                this.ctx.shadowColor = 'rgba(239, 68, 68, 0.6)';
                this.ctx.shadowBlur = 20;
                this.ctx.shadowOffsetY = 8;
                
                this.ctx.fillStyle = gradient;
                this.roundRect(x, y, barWidth, barHeight, 10);
                this.ctx.fill();
                
                this.ctx.shadowBlur = 0;
                this.ctx.shadowOffsetY = 0;

                // Highlight
                const highlightGradient = this.ctx.createLinearGradient(x, y, x, y + 30);
                highlightGradient.addColorStop(0, 'rgba(255, 255, 255, 0.3)');
                highlightGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                this.ctx.fillStyle = highlightGradient;
                this.roundRect(x, y, barWidth, Math.min(30, barHeight), 10);
                this.ctx.fill();

                // Value label
                this.ctx.fillStyle = '#fff';
                this.ctx.font = 'bold 14px Inter, -apple-system, sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                this.ctx.shadowBlur = 4;
                this.ctx.fillText(this.formatNumber(item.value), x + barWidth / 2, y - 12);
                this.ctx.shadowBlur = 0;

                // X-axis label
                this.ctx.fillStyle = '#e2e8f0';
                this.ctx.font = '12px Inter, -apple-system, sans-serif';
                this.ctx.fillText(item.label, x + barWidth / 2, padding.top + chartHeight + 25);
            });
        }

        // Draw premium pie chart
        drawPieChart(data, options = {}) {
            this.clear();
            const centerX = this.width / 2;
            const centerY = (this.height / 2) - 10;
            const radius = Math.min(this.width, this.height) / 3.2;

            const total = data.reduce((sum, item) => sum + item.value, 0);
            
            // Color mapping for booking status
            const statusColors = {
                'Paid': { main: '#10b981', light: '#34d399', dark: '#059669' },
                'Pending': { main: '#f59e0b', light: '#fbbf24', dark: '#d97706' },
                'Cancelled': { main: '#ef4444', light: '#f87171', dark: '#dc2626' }
            };

            let currentAngle = -Math.PI / 2;

            data.forEach((item, index) => {
                const sliceAngle = (item.value / total) * Math.PI * 2;
                const endAngle = currentAngle + sliceAngle;
                const midAngle = currentAngle + sliceAngle / 2;
                
                const colorSet = statusColors[item.label] || { main: '#3b82f6', light: '#60a5fa', dark: '#2563eb' };

                // Draw slice
                const gradient = this.ctx.createRadialGradient(
                    centerX, centerY, 0,
                    centerX, centerY, radius
                );
                gradient.addColorStop(0, colorSet.light);
                gradient.addColorStop(1, colorSet.dark);

                this.ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
                this.ctx.shadowBlur = 15;
                this.ctx.shadowOffsetY = 5;
                
                this.ctx.fillStyle = gradient;
                this.ctx.beginPath();
                this.ctx.moveTo(centerX, centerY);
                this.ctx.arc(centerX, centerY, radius, currentAngle, endAngle);
                this.ctx.closePath();
                this.ctx.fill();
                
                this.ctx.shadowBlur = 0;

                // Label
                const labelRadius = radius + 55;
                const labelX = centerX + Math.cos(midAngle) * labelRadius;
                const labelY = centerY + Math.sin(midAngle) * labelRadius;

                // Connection line
                this.ctx.strokeStyle = colorSet.main;
                this.ctx.lineWidth = 2.5;
                this.ctx.beginPath();
                this.ctx.moveTo(
                    centerX + Math.cos(midAngle) * (radius + 8), 
                    centerY + Math.sin(midAngle) * (radius + 8)
                );
                this.ctx.lineTo(labelX, labelY);
                this.ctx.stroke();

                const textAlign = labelX > centerX ? 'left' : 'right';
                const offset = labelX > centerX ? 8 : -8;
                
                this.ctx.textAlign = textAlign;
                this.ctx.font = 'bold 13px Inter, -apple-system, sans-serif';
                
                this.ctx.fillStyle = '#fff';
                this.ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                this.ctx.shadowBlur = 4;
                this.ctx.fillText(item.label, labelX + offset, labelY - 8);
                
                this.ctx.font = '12px Inter, -apple-system, sans-serif';
                this.ctx.fillStyle = '#cbd5e1';
                const percentage = `${item.value} (${((item.value / total) * 100).toFixed(1)}%)`;
                this.ctx.fillText(percentage, labelX + offset, labelY + 8);
                this.ctx.shadowBlur = 0;

                currentAngle = endAngle;
            });

            // Center donut circle
            const innerGradient = this.ctx.createRadialGradient(
                centerX, centerY, 0,
                centerX, centerY, radius * 0.6
            );
            innerGradient.addColorStop(0, 'rgba(15, 23, 42, 1)');
            innerGradient.addColorStop(1, 'rgba(30, 41, 59, 0.95)');
            
            this.ctx.fillStyle = innerGradient;
            this.ctx.beginPath();
            this.ctx.arc(centerX, centerY, radius * 0.6, 0, Math.PI * 2);
            this.ctx.fill();
        }

        // Draw premium horizontal bar chart
        drawHorizontalBarChart(data, options = {}) {
            this.clear();
            const padding = { top: 30, right: 80, bottom: 30, left: 180 };
            const chartWidth = this.width - padding.left - padding.right;
            const chartHeight = this.height - padding.top - padding.bottom;

            const maxValue = Math.max(...data.map(d => d.value));
            const barHeight = Math.min(chartHeight / data.length * 0.7, 50);
            const barSpacing = chartHeight / data.length;

            data.forEach((item, index) => {
                const y = padding.top + index * barSpacing + (barSpacing - barHeight) / 2;
                const barWidth = (item.value / maxValue) * chartWidth;

                // Gradient
                const gradient = this.ctx.createLinearGradient(padding.left, y, padding.left + barWidth, y);
                gradient.addColorStop(0, '#fcd34d');
                gradient.addColorStop(0.5, '#fbbf24');
                gradient.addColorStop(1, '#d97706');

                // Glow
                this.ctx.shadowColor = 'rgba(251, 191, 36, 0.6)';
                this.ctx.shadowBlur = 15;
                this.ctx.shadowOffsetX = 6;
                
                this.ctx.fillStyle = gradient;
                this.roundRect(padding.left, y, barWidth, barHeight, 10);
                this.ctx.fill();
                this.ctx.shadowBlur = 0;

                // Highlight
                const highlightGradient = this.ctx.createLinearGradient(padding.left, y, padding.left + 40, y);
                highlightGradient.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
                highlightGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                this.ctx.fillStyle = highlightGradient;
                this.roundRect(padding.left, y, Math.min(40, barWidth), barHeight, 10);
                this.ctx.fill();

                // Movie title
                this.ctx.fillStyle = '#fff';
                this.ctx.font = 'bold 14px Inter, -apple-system, sans-serif';
                this.ctx.textAlign = 'right';
                this.ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                this.ctx.shadowBlur = 4;
                const truncatedLabel = this.truncateText(item.label, padding.left - 20);
                this.ctx.fillText(truncatedLabel, padding.left - 12, y + barHeight / 2 + 5);

                // Value
                this.ctx.fillStyle = '#fbbf24';
                this.ctx.font = 'bold 15px Inter, -apple-system, sans-serif';
                this.ctx.textAlign = 'left';
                this.ctx.fillText(item.value.toString(), padding.left + barWidth + 10, y + barHeight / 2 + 5);
                this.ctx.shadowBlur = 0;
            });
        }

        roundRect(x, y, width, height, radius) {
            this.ctx.beginPath();
            this.ctx.moveTo(x + radius, y);
            this.ctx.lineTo(x + width - radius, y);
            this.ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            this.ctx.lineTo(x + width, y + height - radius);
            this.ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            this.ctx.lineTo(x + radius, y + height);
            this.ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            this.ctx.lineTo(x, y + radius);
            this.ctx.quadraticCurveTo(x, y, x + radius, y);
            this.ctx.closePath();
        }

        formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(0) + 'K';
            }
            return num.toFixed(0);
        }

        truncateText(text, maxWidth) {
            let width = this.ctx.measureText(text).width;
            if (width <= maxWidth) return text;
            
            let truncated = text;
            while (width > maxWidth && truncated.length > 0) {
                truncated = truncated.slice(0, -1);
                width = this.ctx.measureText(truncated + '...').width;
            }
            return truncated + '...';
        }
    }

    // Initialize charts with API data
    window.addEventListener('load', async function() {
        console.log('üé¨ CineMax Dashboard - Kh·ªüi t·∫°o bi·ªÉu ƒë·ªì...');
        
        try {
            // Fetch all dashboard data from API
            const response = await fetch('/api/DashboardApi/all');
            if (!response.ok) {
                throw new Error('Failed to fetch dashboard data');
            }
            
            const dashboardData = await response.json();
            console.log('üìä D·ªØ li·ªáu t·ª´ API:', dashboardData);
            
            const revenueData = dashboardData.revenue || [];
            const statusData = dashboardData.bookingStatus || [];
            const moviesData = dashboardData.topMovies || [];
            const movieSchedules = dashboardData.movieSchedules || [];
            
            // Revenue Chart - Highcharts Combo (Column + Line + Spline)
            if (revenueData.length > 0) {
                const categories = revenueData.map(item => item.date || item.Date || '');
                const revenues = revenueData.map(item => parseFloat(item.revenue || item.Revenue || 0));
                
                // Calculate average for line
                const average = revenues.reduce((a, b) => a + b, 0) / revenues.length;
                const averageLine = revenues.map(() => average);
                
                Highcharts.chart('revenueChart', {
                    chart: {
                        backgroundColor: 'transparent',
                        style: {
                            fontFamily: 'Inter, -apple-system, sans-serif'
                        }
                    },
                    title: {
                        text: undefined
                    },
                    xAxis: {
                        categories: categories,
                        crosshair: true,
                        labels: {
                            style: {
                                color: '#cbd5e1',
                                fontSize: '12px'
                            }
                        },
                        gridLineColor: 'rgba(255, 255, 255, 0.05)',
                        lineColor: 'rgba(255, 255, 255, 0.1)'
                    },
                    yAxis: {
                        title: {
                            text: 'Doanh Thu (VNƒê)',
                            style: {
                                color: '#cbd5e1',
                                fontSize: '13px'
                            }
                        },
                        labels: {
                            style: {
                                color: '#cbd5e1',
                                fontSize: '11px'
                            },
                            formatter: function() {
                                if (this.value >= 1000000) {
                                    return (this.value / 1000000).toFixed(1) + 'M';
                                } else if (this.value >= 1000) {
                                    return (this.value / 1000).toFixed(0) + 'K';
                                }
                                return this.value;
                            }
                        },
                        gridLineColor: 'rgba(255, 255, 255, 0.05)'
                    },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderRadius: 8,
                        style: {
                            color: '#fff',
                            fontSize: '13px'
                        },
                        shared: true,
                        formatter: function() {
                            let tooltip = '<b>' + this.x + '</b><br/>';
                            this.points.forEach(point => {
                                const value = point.y.toLocaleString('vi-VN');
                                tooltip += '<span style="color:' + point.color + '">‚óè</span> ' + 
                                          point.series.name + ': <b>' + value + ' VNƒê</b><br/>';
                            });
                            return tooltip;
                        }
                    },
                    legend: {
                        align: 'center',
                        verticalAlign: 'bottom',
                        itemStyle: {
                            color: '#cbd5e1',
                            fontSize: '12px',
                            fontWeight: '500'
                        },
                        itemHoverStyle: {
                            color: '#fff'
                        }
                    },
                    plotOptions: {
                        column: {
                            borderRadius: 6,
                            borderWidth: 0,
                            dataLabels: {
                                enabled: false
                            }
                        },
                        line: {
                            marker: {
                                enabled: true,
                                radius: 4
                            }
                        },
                        spline: {
                            marker: {
                                enabled: false
                            }
                        }
                    },
                    series: [{
                        name: 'Doanh Thu',
                        type: 'column',
                        data: revenues,
                        color: {
                            linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                            stops: [
                                [0, '#ef4444'],
                                [1, '#dc2626']
                            ]
                        }
                    }, {
                        name: 'Trung B√¨nh',
                        type: 'line',
                        data: averageLine,
                        color: '#fbbf24',
                        dashStyle: 'ShortDash',
                        marker: {
                            enabled: false
                        }
                    }, {
                        name: 'Xu H∆∞·ªõng',
                        type: 'spline',
                        data: revenues,
                        color: '#3b82f6',
                        lineWidth: 2
                    }],
                    credits: { enabled: false },
                    exporting: { enabled: false }
                });
                console.log('‚úÖ Bi·ªÉu ƒë·ªì Combo ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o');
            }

            // Status Chart - 3D Donut Chart
            if (statusData.length > 0) {
                const statusColors = {
                    'Paid': '#10b981',
                    'Pending': '#f59e0b',
                    'Cancelled': '#ef4444'
                };
                
                const statusVietnamese = {
                    'Paid': 'ƒê√£ Thanh To√°n',
                    'Pending': 'Ch·ªù X·ª≠ L√Ω',
                    'Cancelled': 'ƒê√£ H·ªßy'
                };
                
                const chartData = statusData.map(item => {
                    const statusKey = item.status || item.Status || '';
                    return {
                        name: statusVietnamese[statusKey] || statusKey,
                        y: parseInt(item.count || item.Count || 0),
                        color: statusColors[statusKey] || '#3b82f6'
                    };
                });
                
                Highcharts.chart('statusChart', {
                    chart: {
                        type: 'pie',
                        backgroundColor: 'transparent',
                        options3d: {
                            enabled: true,
                            alpha: 55,
                            beta: 0
                        },
                        style: {
                            fontFamily: 'Inter, -apple-system, sans-serif'
                        }
                    },
                    title: {
                        text: undefined
                    },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderRadius: 8,
                        style: {
                            color: '#fff',
                            fontSize: '13px'
                        },
                        pointFormat: '<b>{point.percentage:.1f}%</b><br/>S·ªë l∆∞·ª£ng: <b>{point.y}</b>'
                    },
                    accessibility: {
                        point: {
                            valueSuffix: '%'
                        }
                    },
                    plotOptions: {
                        pie: {
                            innerSize: '50%',
                            depth: 45,
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b><br/>{point.percentage:.1f}%',
                                style: {
                                    color: '#fff',
                                    fontSize: '12px',
                                    fontWeight: 'bold',
                                    textOutline: '2px rgba(0, 0, 0, 0.9)'
                                },
                                distance: 15,
                                connectorWidth: 1,
                                connectorColor: 'rgba(255, 255, 255, 0.3)'
                            },
                            showInLegend: true,
                            borderWidth: 0,
                            shadow: {
                                color: 'rgba(0, 0, 0, 0.5)',
                                offsetX: 0,
                                offsetY: 8,
                                opacity: 0.5,
                                width: 10
                            }
                        }
                    },
                    legend: {
                        layout: 'horizontal',
                        align: 'center',
                        verticalAlign: 'bottom',
                        itemStyle: {
                            color: '#e2e8f0',
                            fontSize: '13px',
                            fontWeight: '500'
                        },
                        itemHoverStyle: {
                            color: '#fff'
                        },
                        itemMarginBottom: 5,
                        symbolRadius: 6,
                        symbolHeight: 10,
                        symbolWidth: 10
                    },
                    responsive: {
                        rules: [{
                            condition: {
                                maxWidth: 500
                            },
                            chartOptions: {
                                legend: {
                                    layout: 'horizontal',
                                    align: 'center',
                                    verticalAlign: 'bottom'
                                },
                                plotOptions: {
                                    pie: {
                                        dataLabels: {
                                            distance: 10,
                                            fontSize: '11px'
                                        }
                                    }
                                }
                            }
                        }]
                    },
                    series: [{
                        name: 'Tr·∫°ng th√°i',
                        data: chartData
                    }],
                    credits: { enabled: false },
                    exporting: { enabled: false }
                });
                console.log('‚úÖ Bi·ªÉu ƒë·ªì 3D Donut ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o');
            }

            // Gantt Chart - Movie Schedules
            if (movieSchedules.length > 0) {
                const categories = movieSchedules.map(m => m.name);
                const seriesData = [];
                
                movieSchedules.forEach((movie, index) => {
                    if (movie.data && movie.data.length > 0) {
                        movie.data.forEach(showtime => {
                            seriesData.push({
                                start: showtime.start,
                                end: showtime.end,
                                y: index,
                                name: movie.name
                            });
                        });
                    }
                });
                
                console.log('üìÖ Gantt data:', { categories, seriesData });
                
                if (seriesData.length > 0) {
                    Highcharts.ganttChart('ganttChart', {
                        chart: {
                            backgroundColor: 'transparent',
                            style: {
                                fontFamily: 'Inter, -apple-system, sans-serif'
                            }
                        },
                        title: {
                            text: undefined
                        },
                        xAxis: {
                            currentDateIndicator: {
                                color: '#ef4444',
                                width: 2,
                                label: {
                                    format: '%H:%M',
                                    style: {
                                        color: '#ef4444',
                                        fontWeight: 'bold'
                                    }
                                }
                            },
                            labels: {
                                format: '{value:%H:%M}',
                                style: { 
                                    color: '#cbd5e1',
                                    fontSize: '11px'
                                }
                            },
                            gridLineColor: 'rgba(255,255,255,0.05)'
                        },
                        yAxis: {
                            type: 'category',
                            categories: categories,
                            gridLineWidth: 1,
                            gridLineColor: 'rgba(255,255,255,0.1)',
                            labels: {
                                style: {
                                    color: '#fff',
                                    fontSize: '13px',
                                    fontWeight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            style: {
                                color: '#fff'
                            },
                            pointFormat: '<b>{point.name}</b><br/>B·∫Øt ƒë·∫ßu: {point.start:%H:%M %d/%m}<br/>K·∫øt th√∫c: {point.end:%H:%M %d/%m}'
                        },
                        plotOptions: {
                            series: {
                                borderRadius: 8,
                                borderWidth: 0,
                                dataLabels: {
                                    enabled: false
                                }
                            }
                        },
                        series: [{
                            name: 'L·ªãch Chi·∫øu',
                            data: seriesData,
                            colorByPoint: false,
                            color: {
                                linearGradient: { x1: 0, x2: 1, y1: 0, y2: 0 },
                                stops: [
                                    [0, '#fcd34d'],
                                    [0.5, '#fbbf24'],
                                    [1, '#d97706']
                                ]
                            }
                        }],
                        credits: { enabled: false },
                        exporting: { enabled: false }
                    });
                    console.log('‚úÖ Bi·ªÉu ƒë·ªì Gantt ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o');
                } else {
                    document.getElementById('ganttChart').innerHTML = 
                        '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #94a3b8; font-size: 14px;">' +
                        '<i class="bi bi-calendar-x me-2"></i>Ch∆∞a c√≥ l·ªãch chi·∫øu trong 7 ng√†y t·ªõi' +
                        '</div>';
                }
            } else {
                document.getElementById('ganttChart').innerHTML = 
                    '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #94a3b8; font-size: 14px;">' +
                    '<i class="bi bi-film me-2"></i>Ch∆∞a c√≥ d·ªØ li·ªáu phim' +
                    '</div>';
            }
            
            console.log('‚úÖ T·∫•t c·∫£ bi·ªÉu ƒë·ªì ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o!');
        } catch (error) {
            console.error('‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu dashboard:', error);
            
            // Show error message
            const errorHtml = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ef4444; font-size: 14px;">' +
                '<i class="bi bi-exclamation-triangle me-2"></i>Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.' +
                '</div>';
            
            document.getElementById('ganttChart').innerHTML = errorHtml;
        }

        // Redraw on resize
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => location.reload(), 500);
        });
    });

</script>
